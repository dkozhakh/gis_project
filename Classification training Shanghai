/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var l7Raw = ee.ImageCollection("LANDSAT/LE7_L1T"),
    BU_training = /* color: #0b4a8b */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49237394332886, 31.241966893004953],
                  [121.49204134941101, 31.241434858111504],
                  [121.49223446846008, 31.241049589593715],
                  [121.49302840232849, 31.241462377231212],
                  [121.49273872375488, 31.242012757941655]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49491667747498, 31.24210448774825],
                  [121.49474501609802, 31.241664183864106],
                  [121.49553894996643, 31.24164583782439],
                  [121.49547457695007, 31.24215952558946]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4958930015564, 31.240535895792128],
                  [121.49557113647461, 31.24004054555189],
                  [121.49613976478577, 31.239857081840746],
                  [121.49662256240845, 31.240315740450498]]]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.48582935333252, 31.240930339495918],
                  [121.48579716682434, 31.240636800152206],
                  [121.48617267608643, 31.24065514638792],
                  [121.48616194725037, 31.240957858762624]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.48247122764587, 31.24058176142372],
                  [121.48251414299011, 31.24035243304309],
                  [121.48301839828491, 31.24049003013827],
                  [121.48292183876038, 31.2407377044045]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4764952659607, 31.23710508341345],
                  [121.47659182548523, 31.23677483821456],
                  [121.47743940353394, 31.23704086915963],
                  [121.47729992866516, 31.237389460298523],
                  [121.47640943527222, 31.23710508341345],
                  [121.47650599479675, 31.236921614001048]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47909164428711, 31.237939864740973],
                  [121.47916674613953, 31.237609622460326],
                  [121.47951006889343, 31.23773805015109],
                  [121.47934913635254, 31.238031598502932]]]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47029399871826, 31.236242774076903],
                  [121.47030472755432, 31.23596756731264],
                  [121.47110939025879, 31.236004261594175],
                  [121.47112011909485, 31.23642624480771]]]),
            {
              "landcover": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47093772888184, 31.23465573738448],
                  [121.47113084793091, 31.234261267480267],
                  [121.47130250930786, 31.234307136158403],
                  [121.47116303443909, 31.234729126952388]]]),
            {
              "landcover": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.45780563354492, 31.231784325792354],
                  [121.45787000656128, 31.231298103688736],
                  [121.45843863487244, 31.2313256257614],
                  [121.4583957195282, 31.231940283295625]]]),
            {
              "landcover": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50267899036407, 31.31481544414822],
                  [121.5026843547821, 31.314512968727254],
                  [121.50330662727356, 31.31450380279025],
                  [121.50336563587189, 31.31485669072129]]]),
            {
              "landcover": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50386452674866, 31.311987719350256],
                  [121.50386452674866, 31.311786063123325],
                  [121.50428831577301, 31.31174481520554],
                  [121.50433659553528, 31.31199688553211],
                  [121.50390207767487, 31.311987719350256]]]),
            {
              "landcover": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50164365768433, 31.31164856999381],
                  [121.5016382932663, 31.31139649873508],
                  [121.50196015834808, 31.31136900001148],
                  [121.50196015834808, 31.311676068635755]]]),
            {
              "landcover": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50319397449493, 31.310406539628595],
                  [121.5031349658966, 31.310209463194354],
                  [121.50382697582245, 31.31021404637192],
                  [121.50381624698639, 31.31048445345399]]]),
            {
              "landcover": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50331735610962, 31.30847700609877],
                  [121.50324761867523, 31.308169927045963],
                  [121.5044116973877, 31.3081836768757],
                  [121.50437951087952, 31.3084907558837]]]),
            {
              "landcover": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49912774562836, 31.308894082015197],
                  [121.49943888187408, 31.3083624244797],
                  [121.4995676279068, 31.308422006939008],
                  [121.4992243051529, 31.308962830615343]]]),
            {
              "landcover": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4999109506607, 31.302385654016064],
                  [121.49987876415253, 31.302133557971803],
                  [121.50063514709473, 31.301684366984997],
                  [121.50127351284027, 31.301886044835786],
                  [121.50161683559418, 31.30200521790835],
                  [121.50143444538116, 31.302367319781045],
                  [121.5010267496109, 31.302312317054582],
                  [121.50044202804565, 31.302578163268436],
                  [121.50031328201294, 31.302326067739198]]]),
            {
              "landcover": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49714291095734, 31.297247345062544],
                  [121.49705171585083, 31.29694939705595],
                  [121.49728775024414, 31.29689897499241],
                  [121.49744868278503, 31.297109830715016]]]),
            {
              "landcover": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49556577205658, 31.296124305352617],
                  [121.49563014507294, 31.29584468930334],
                  [121.49638652801514, 31.295849273179687],
                  [121.49634897708893, 31.296289324271157]]]),
            {
              "landcover": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49862349033356, 31.294785807893028],
                  [121.49913311004639, 31.29416239162906],
                  [121.49978756904602, 31.294529107577844],
                  [121.49928867816925, 31.295134185774018]]]),
            {
              "landcover": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49394035339355, 31.291045248460325],
                  [121.49395108222961, 31.290898556830523],
                  [121.49432122707367, 31.290912309180502],
                  [121.49433195590973, 31.29104983257007]]]),
            {
              "landcover": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43113374710083, 31.181862986827984],
                  [121.43124103546143, 31.180577943056125],
                  [121.43158435821533, 31.180174068554127],
                  [121.43263578414917, 31.18081659536115],
                  [121.43173456192017, 31.18224849655835]]]),
            {
              "landcover": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43081188201904, 31.17846676185237],
                  [121.43049001693726, 31.177034803461698],
                  [121.43089771270752, 31.176998086295146]]]),
            {
              "landcover": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.42690658569336, 31.175309081243217],
                  [121.42703533172607, 31.174721594163707],
                  [121.42823696136475, 31.17477667123225],
                  [121.42812967300415, 31.175254004484362]]]),
            {
              "landcover": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43179893493652, 31.172426687835607],
                  [121.43205642700195, 31.17174738489608],
                  [121.43237829208374, 31.172022778566912],
                  [121.4322280883789, 31.172665360684718]]]),
            {
              "landcover": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43808603286743, 31.16557835681301],
                  [121.43437385559082, 31.16311797759962],
                  [121.43441677093506, 31.162456969310234],
                  [121.43845081329346, 31.16510097479758]]]),
            {
              "landcover": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.44428193569183, 31.162175953321416],
                  [121.44445359706879, 31.16185921760904],
                  [121.44511878490448, 31.162125459293293],
                  [121.44501149654388, 31.16237333880954]]]),
            {
              "landcover": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43877267837524, 31.162221856960002],
                  [121.43887996673584, 31.162084145977527],
                  [121.43929839134216, 31.16218054368627],
                  [121.43916964530945, 31.162327435244364]]]),
            {
              "landcover": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43926620483398, 31.163094021867575],
                  [121.43895506858826, 31.162901228210796],
                  [121.43911063671112, 31.162781879560004],
                  [121.43943250179291, 31.16295631215277]]]),
            {
              "landcover": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.43790364265442, 31.159697123812602],
                  [121.43801093101501, 31.15949514225464],
                  [121.43935739994049, 31.160000095342287],
                  [121.43927693367004, 31.160183713979727]]]),
            {
              "landcover": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.44133150577545, 31.159440056300472],
                  [121.44135296344757, 31.158999367514294],
                  [121.44148170948029, 31.158857061322678],
                  [121.44165873527527, 31.158838699217856],
                  [121.44202888011932, 31.158921328661478],
                  [121.44179821014404, 31.159628266511657],
                  [121.44132614135742, 31.159481370769097]]]),
            {
              "landcover": 1,
              "system:index": "30"
            })]),
    NBU_training = /* color: #ffc82d */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[121.46703243255615, 31.23388514347959],
                  [121.46707534790039, 31.233224629415837],
                  [121.46772980690002, 31.2335273656016],
                  [121.46742939949036, 31.233967707412894]]]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.46033763885498, 31.231004534414804],
                  [121.4604127407074, 31.2308027050099],
                  [121.46061658859253, 31.23088527163675],
                  [121.46057367324829, 31.231105448955606]]]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47373795509338, 31.229444932353886],
                  [121.47384524345398, 31.22911466037951],
                  [121.47408127784729, 31.22911466037951],
                  [121.47388815879822, 31.229481629168678]]]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49313569068909, 31.23213293632662],
                  [121.49336099624634, 31.23152745404937],
                  [121.49374723434448, 31.23179349977026],
                  [121.49344682693481, 31.232288893254484]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49232029914856, 31.24650741369479],
                  [121.49204134941101, 31.24611299328276],
                  [121.49259924888611, 31.246002922176086],
                  [121.49279236793518, 31.246479896045088]]]),
            {
              "landcover": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.32356643676758, 31.24122387792738],
                  [121.32354497909546, 31.240416645045784],
                  [121.32474660873413, 31.240545068920238],
                  [121.32466077804565, 31.241407338983805]]]),
            {
              "landcover": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.32993936538696, 31.23740780716495],
                  [121.32978916168213, 31.236692276734427],
                  [121.33028268814087, 31.2365088065203],
                  [121.33056163787842, 31.237261032133855]]]),
            {
              "landcover": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.32826566696167, 31.23511442124857],
                  [121.3284158706665, 31.234527305503477],
                  [121.32933855056763, 31.234802516463272],
                  [121.32916688919067, 31.23531624144328]]]),
            {
              "landcover": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.33169889450073, 31.234288788689827],
                  [121.33180618286133, 31.233720015396575],
                  [121.33287906646729, 31.23401357623354],
                  [121.3326644897461, 31.234527305503477]]]),
            {
              "landcover": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.33942365646362, 31.238453572660557],
                  [121.33942365646362, 31.237316072797235],
                  [121.3400673866272, 31.237316072797235],
                  [121.33993864059448, 31.238508612629097]]]),
            {
              "landcover": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53170585632324, 31.2522859424759],
                  [121.53273582458496, 31.250745036045743],
                  [121.53582572937012, 31.252506069912993],
                  [121.5336799621582, 31.253459949542773]]]),
            {
              "landcover": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55488014221191, 31.26820716952122],
                  [121.55221939086914, 31.266152968564715],
                  [121.55342102050781, 31.264245456204982],
                  [121.55668258666992, 31.267033345879277]]]),
            {
              "landcover": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.497802734375, 31.30465448806321],
                  [121.49764716625214, 31.30458115286762],
                  [121.4976578950882, 31.304507817614933],
                  [121.49792611598969, 31.304567402512074]]]),
            {
              "landcover": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49477183818817, 31.304539901795007],
                  [121.4945250749588, 31.30448031688046],
                  [121.49461627006531, 31.304342813087718],
                  [121.49471282958984, 31.304342813087718]]]),
            {
              "landcover": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49832308292389, 31.306487849401393],
                  [121.49854838848114, 31.30661618335897],
                  [121.49843037128448, 31.306717017060148],
                  [121.49834454059601, 31.306689516970536]]]),
            {
              "landcover": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49864494800568, 31.306946184161465],
                  [121.4987200498581, 31.306625350063527],
                  [121.49902582168579, 31.30662993341549],
                  [121.49904191493988, 31.306822433995986]]]),
            {
              "landcover": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4888870716095, 31.306978267511155],
                  [121.48879587650299, 31.306657433522503],
                  [121.4892303943634, 31.306584099885946],
                  [121.48921966552734, 31.306877434089614]]]),
            {
              "landcover": 0,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4891391992569, 31.310434038633154],
                  [121.48914992809296, 31.310223212726388],
                  [121.48938059806824, 31.31023237907997],
                  [121.48938059806824, 31.31042487229919]]]),
            {
              "landcover": 0,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49249732494354, 31.311034431564913],
                  [121.49249732494354, 31.31075485975982],
                  [121.49279773235321, 31.310777775512772],
                  [121.49279236793518, 31.311071096658146]]]),
            {
              "landcover": 0,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49239540100098, 31.312010634803265],
                  [121.49240612983704, 31.31176773071766],
                  [121.49316251277924, 31.311776896920932],
                  [121.49316787719727, 31.312038133339517]]]),
            {
              "landcover": 0,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49232029914856, 31.313284725218576],
                  [121.49233102798462, 31.312881417886672],
                  [121.49258315563202, 31.31277142467825],
                  [121.49283528327942, 31.31285391959662],
                  [121.49323761463165, 31.313032658338503],
                  [121.49325370788574, 31.313197647645367],
                  [121.49303376674652, 31.31330764035602]]]),
            {
              "landcover": 0,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4938223361969, 31.314435058234217],
                  [121.49375796318054, 31.313958427932427],
                  [121.4937150478363, 31.313720111876993],
                  [121.49405300617218, 31.313678864806175],
                  [121.49454116821289, 31.31366969878798],
                  [121.49449825286865, 31.31387593398148],
                  [121.49419248104095, 31.3142013263684]]]),
            {
              "landcover": 0,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49252951145172, 31.31490710317493],
                  [121.49249196052551, 31.314700870239424],
                  [121.49288892745972, 31.314609211012034],
                  [121.49298012256622, 31.31482461005492]]]),
            {
              "landcover": 0,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49265825748444, 31.315177496783914],
                  [121.49274408817291, 31.314975847386393],
                  [121.4932107925415, 31.315200411460864],
                  [121.49319469928741, 31.31533331647718]]]),
            {
              "landcover": 0,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4964509010315, 31.31680442499197],
                  [121.49646699428558, 31.31667152205172],
                  [121.49678349494934, 31.316749430694617],
                  [121.49675667285919, 31.316877750671825]]]),
            {
              "landcover": 0,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49790465831757, 31.31737269751745],
                  [121.49795293807983, 31.31702898470618],
                  [121.49863958358765, 31.31718938417423],
                  [121.4985591173172, 31.31744143992915]]]),
            {
              "landcover": 0,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49883270263672, 31.318467987307383],
                  [121.49889707565308, 31.31825717938386],
                  [121.49910628795624, 31.31829384166533],
                  [121.49905800819397, 31.318509232280714]]]),
            {
              "landcover": 0,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50478184223175, 31.317436857103257],
                  [121.5047174692154, 31.317207715524617],
                  [121.50496423244476, 31.31706106462166],
                  [121.5051144361496, 31.317340617708147]]]),
            {
              "landcover": 0,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50346219539642, 31.31740936014326],
                  [121.50353193283081, 31.317047316087788],
                  [121.50400400161743, 31.317047316087788],
                  [121.50398254394531, 31.31746893687978]]]),
            {
              "landcover": 0,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50412738323212, 31.316621110542552],
                  [121.50408446788788, 31.316286560752534],
                  [121.50483012199402, 31.316204068840833],
                  [121.50485694408417, 31.316676104914844]]]),
            {
              "landcover": 0,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50598347187042, 31.316992321932283],
                  [121.50554358959198, 31.3163278066813],
                  [121.50690615177155, 31.315956592672194],
                  [121.50737822055817, 31.316547784662887]]]),
            {
              "landcover": 0,
              "system:index": "30"
            })]),
    BU_validation = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54429346323013, 31.13414440287819],
                  [121.54429882764816, 31.133933183407883],
                  [121.5443766117096, 31.13361635332059],
                  [121.54440611600876, 31.133522222438557],
                  [121.54470920562744, 31.133563548203142],
                  [121.5445026755333, 31.134206391111704]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54462337493896, 31.134263787588093],
                  [121.54478698968887, 31.133572731703932],
                  [121.5450069308281, 31.133595690452054],
                  [121.54485672712326, 31.134360213590263]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54640436172485, 31.13382068588935],
                  [121.5465384721756, 31.13333396039426],
                  [121.54724389314651, 31.13349696779577],
                  [121.5471339225769, 31.133988284184614]]]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.5463587641716, 31.134089302192145],
                  [121.54638558626175, 31.133963029665946],
                  [121.54715269804001, 31.134112260815225],
                  [121.54708296060562, 31.134252308295608]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54867351055145, 31.133901041273347],
                  [121.54890954494476, 31.13299876119538],
                  [121.54975175857544, 31.13315947328785],
                  [121.54948890209198, 31.133999763509077]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54973298311234, 31.13402272215382],
                  [121.54993414878845, 31.13323753334882],
                  [121.55069053173065, 31.133402836795277],
                  [121.55046790838242, 31.134169657348586]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55127257108688, 31.135512726314047],
                  [121.55143618583679, 31.134823975374072],
                  [121.55270487070084, 31.135087997158887],
                  [121.55253320932388, 31.13561833434927]]]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55407816171646, 31.1353772723576],
                  [121.55420422554016, 31.135170647305685],
                  [121.5544456243515, 31.13527855155561],
                  [121.55453681945801, 31.135388751513958],
                  [121.55447512865067, 31.135487472201245],
                  [121.55424982309341, 31.135489768029963]]]),
            {
              "landcover": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55387163162231, 31.135946636838238],
                  [121.55384480953217, 31.135804296038494],
                  [121.5539413690567, 31.13557930530648],
                  [121.55421763658524, 31.135632109301724],
                  [121.55426323413849, 31.135762971250188],
                  [121.5544080734253, 31.135700984033942],
                  [121.55451267957687, 31.135735421381312],
                  [121.55449390411377, 31.13581807096395],
                  [121.55472993850708, 31.13593286193148],
                  [121.55468165874481, 31.136038469498885],
                  [121.55455559492111, 31.136086681610138],
                  [121.55437052249908, 31.136072906723708]]]),
            {
              "landcover": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55591547489166, 31.135799704396252],
                  [121.5559047460556, 31.13566654667408],
                  [121.55605763196945, 31.13569868821034],
                  [121.55606299638748, 31.13576985871616]]]),
            {
              "landcover": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55408352613449, 31.13837328502635],
                  [121.55419886112213, 31.13745497702574],
                  [121.5548586845398, 31.137526146213645],
                  [121.55464947223663, 31.13839853837076]]]),
            {
              "landcover": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55397087335587, 31.13900691236235],
                  [121.55407816171646, 31.13840542564531],
                  [121.5546253323555, 31.138423791708423],
                  [121.5545904636383, 31.139119403729485]]]),
            {
              "landcover": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55198335647583, 31.139670379926862],
                  [121.55209869146347, 31.138910491084324],
                  [121.55265927314758, 31.138963293224922],
                  [121.55256807804108, 31.1394729471575],
                  [121.55254393815994, 31.139652014105195],
                  [121.55241519212723, 31.139661197016487],
                  [121.55238300561905, 31.139762208981878]]]),
            {
              "landcover": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55007630586624, 31.138536283767237],
                  [121.5501406788826, 31.138074835901488],
                  [121.55027478933334, 31.138093202028596],
                  [121.55021846294403, 31.138561537068217]]]),
            {
              "landcover": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54656797647476, 31.138017441731332],
                  [121.54666990041733, 31.137679963308262],
                  [121.54679596424103, 31.137689146410516],
                  [121.54668062925339, 31.13805646977082]]]),
            {
              "landcover": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54682546854019, 31.137842963240768],
                  [121.54685765504837, 31.13772358303598],
                  [121.54735654592514, 31.137808526658667],
                  [121.54734581708908, 31.13796004752644],
                  [121.54681742191315, 31.137881991352064]]]),
            {
              "landcover": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54445171356201, 31.137184074467097],
                  [121.54451072216034, 31.13697515755867],
                  [121.54500961303711, 31.137083059755643],
                  [121.54491573572159, 31.137301159566203]]]),
            {
              "landcover": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.34026050567627, 31.193280752511644],
                  [121.34023904800415, 31.190802737116073],
                  [121.34118318557739, 31.19074766937032],
                  [121.3410758972168, 31.19315226441947]]]),
            {
              "landcover": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.3363766670227, 31.194308650968484],
                  [121.33639812469482, 31.192876932205937],
                  [121.33695602416992, 31.192656665858344],
                  [121.33676290512085, 31.19421687477449]]]),
            {
              "landcover": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.3404107093811, 31.201595396647473],
                  [121.3404107093811, 31.199778351382292],
                  [121.34317874908447, 31.199741643037513],
                  [121.34281396865845, 31.20155868900773]]]),
            {
              "landcover": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.348135471344, 31.20229283909648],
                  [121.34807109832764, 31.20157704282937],
                  [121.34875774383545, 31.20155868900773],
                  [121.3488221168518, 31.202219424343998]]]),
            {
              "landcover": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.33187055587769, 31.20348582083899],
                  [121.33191347122192, 31.201870703491604],
                  [121.33262157440186, 31.2019624722616],
                  [121.33283615112305, 31.203265579188145]]]),
            {
              "landcover": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4089035987854, 31.21565337516849],
                  [121.40853881835938, 31.215488215229346],
                  [121.40864610671997, 31.215084489719057],
                  [121.409010887146, 31.214974382462504],
                  [121.40916109085083, 31.214974382462504],
                  [121.40950441360474, 31.215231299194972],
                  [121.40941858291626, 31.21556161968235]]]),
            {
              "landcover": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49491131305695, 31.314586296191244],
                  [121.49493277072906, 31.314435058234217],
                  [121.4953887462616, 31.314476304973848],
                  [121.49537265300751, 31.31459546212023]]]),
            {
              "landcover": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4950829744339, 31.312798922992396],
                  [121.49520099163055, 31.312647682165263],
                  [121.49590373039246, 31.312734760246897],
                  [121.49580180644989, 31.312899750075577]]]),
            {
              "landcover": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49198234081268, 31.31238186436539],
                  [121.49199843406677, 31.311808978625386],
                  [121.49217009544373, 31.311781480022244],
                  [121.49212181568146, 31.3123910305089]]]),
            {
              "landcover": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49063050746918, 31.311808978625386],
                  [121.49060368537903, 31.31164856999381],
                  [121.49111330509186, 31.311630237561374],
                  [121.49110794067383, 31.311827311023045]]]),
            {
              "landcover": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.48902118206024, 31.310530285085882],
                  [121.48938596248627, 31.31053945140959],
                  [121.48941814899445, 31.310929019342424],
                  [121.4886885881424, 31.310901520482364],
                  [121.48846328258514, 31.310896937338235],
                  [121.48842573165894, 31.310388206954435],
                  [121.48849546909332, 31.310282794008742],
                  [121.48864567279816, 31.310287377182743],
                  [121.48860275745392, 31.310461537629696],
                  [121.48870468139648, 31.31055778405431]]]),
            {
              "landcover": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49176239967346, 31.310814440705897],
                  [121.49176239967346, 31.31029654353009],
                  [121.4919501543045, 31.31031487622211],
                  [121.49199306964874, 31.310846522738153]]]),
            {
              "landcover": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49506688117981, 31.30958614896708],
                  [121.49494349956512, 31.309045328869306],
                  [121.49590909481049, 31.308971997091568],
                  [121.49580717086792, 31.309251574188107],
                  [121.4960914850235, 31.309343238629292],
                  [121.49604856967926, 31.309567816133264],
                  [121.49576425552368, 31.309696145895128]]]),
            {
              "landcover": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4929586648941, 31.30973739471003],
                  [121.4929586648941, 31.309494484762254],
                  [121.49361848831177, 31.309494484762254],
                  [121.49363994598389, 31.30973739471003]]]),
            {
              "landcover": 1,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49522244930267, 31.306964517505502],
                  [121.49507224559784, 31.30701493418317],
                  [121.49484694004059, 31.30703326751382],
                  [121.4944714307785, 31.306817850653417],
                  [121.4949381351471, 31.30650159947664],
                  [121.49557650089264, 31.306749100487902],
                  [121.49540483951569, 31.307102017471962]]]),
            {
              "landcover": 1,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49656355381012, 31.303930300505453],
                  [121.49672448635101, 31.303797379399782],
                  [121.49735748767853, 31.303875298691377],
                  [121.49741113185883, 31.303985302287444],
                  [121.49703025817871, 31.30412739007564],
                  [121.49660646915436, 31.3040723883766]]]),
            {
              "landcover": 1,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49855375289917, 31.304585736318995],
                  [121.49880588054657, 31.303999052727917],
                  [121.49954617023468, 31.304173224800305],
                  [121.49919211864471, 31.30483782580243]]]),
            {
              "landcover": 1,
              "system:index": "33"
            })]),
    NBU_validation = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[121.4633309841156, 31.224411886544814],
                  [121.46351337432861, 31.224081596981026],
                  [121.46380305290222, 31.224136645321806],
                  [121.46371722221375, 31.224384362458583]]]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.46636724472046, 31.22611836423703],
                  [121.4662492275238, 31.225742207823167],
                  [121.46666765213013, 31.225742207823167],
                  [121.46668910980225, 31.22607249158379]]]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47287964820862, 31.225008239778248],
                  [121.47308349609375, 31.22457703089387],
                  [121.47351264953613, 31.224558681536],
                  [121.47333025932312, 31.22504493831588]]]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47881269454956, 31.225622938403735],
                  [121.47882342338562, 31.22522843079023],
                  [121.47914528846741, 31.22521925617497],
                  [121.47898435592651, 31.225632112979813]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47212862968445, 31.228567931579406],
                  [121.47251486778259, 31.227760590556173],
                  [121.47312641143799, 31.227999123849063],
                  [121.47278308868408, 31.22859545444725]]]),
            {
              "landcover": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.47075533866882, 31.22801747253897],
                  [121.47109866142273, 31.227411963891203],
                  [121.47163510322571, 31.227622974921005],
                  [121.4712917804718, 31.22818261058778]]]),
            {
              "landcover": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.48901581764221, 31.235861211150397],
                  [121.48879051208496, 31.23526492640626],
                  [121.48952007293701, 31.235017237790792],
                  [121.48976683616638, 31.235576829664947]]]),
            {
              "landcover": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.48869395256042, 31.243566706167638],
                  [121.48835062980652, 31.24267693705979],
                  [121.48924112319946, 31.242548516083968],
                  [121.48938059806824, 31.24358505183423]]]),
            {
              "landcover": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49554967880249, 31.246694590828458],
                  [121.49489521980286, 31.24627265348812],
                  [121.49516344070435, 31.24579567857239],
                  [121.49607539176941, 31.24560305340429],
                  [121.49723410606384, 31.245823196421476],
                  [121.49562478065491, 31.246712935887444]]]),
            {
              "landcover": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.49524927139282, 31.249409620790857],
                  [121.49489521980286, 31.249281208970356],
                  [121.49503469467163, 31.249106935506056],
                  [121.49546384811401, 31.249244519846705]]]),
            {
              "landcover": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.50115013122559, 31.25095972113171],
                  [121.50096774101257, 31.25095972113171],
                  [121.50086045265198, 31.25082213929034]]]),
            {
              "landcover": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.51301622390747, 31.267220482316272],
                  [121.51326298713684, 31.266697760313107],
                  [121.51358485221863, 31.266899513008347],
                  [121.51329517364502, 31.26724799392043]]]),
            {
              "landcover": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.52533292770386, 31.256710462761202],
                  [121.52501106262207, 31.256527031435482],
                  [121.52524709701538, 31.256215197363733],
                  [121.52563333511353, 31.25649034512759]]]),
            {
              "landcover": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53253197669983, 31.254371686658725],
                  [121.53262853622437, 31.25405067365179],
                  [121.53299331665039, 31.254188250788427],
                  [121.53278946876526, 31.254518435098348]]]),
            {
              "landcover": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53026819229126, 31.246960593834984],
                  [121.53034329414368, 31.246612038018906],
                  [121.53138399124146, 31.24688721377009],
                  [121.53123378753662, 31.247263285999914]]]),
            {
              "landcover": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.52895927429199, 31.240943239153186],
                  [121.52898073196411, 31.240768950301675],
                  [121.52927041053772, 31.240915719882214],
                  [121.52920603752136, 31.24107166231166]]]),
            {
              "landcover": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.52792930603027, 31.240468960596072],
                  [121.52796149253845, 31.24028549771701],
                  [121.52832090854645, 31.240381815772963],
                  [121.52827262878418, 31.24054234564792]]]),
            {
              "landcover": 0,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53089582920074, 31.239964436821225],
                  [121.53076171875, 31.239886464724684],
                  [121.53082609176636, 31.23981307916328],
                  [121.53102457523346, 31.239900224511107],
                  [121.53108358383179, 31.239982783187543]]]),
            {
              "landcover": 0,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53075635433197, 31.238088502057387],
                  [121.53084754943848, 31.237726153396913],
                  [121.53118550777435, 31.237781193789285],
                  [121.53108358383179, 31.23801511509914]]]),
            {
              "landcover": 0,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53114259243011, 31.237152814069386],
                  [121.53105676174164, 31.236996865170333],
                  [121.53128743171692, 31.236928064103605],
                  [121.53140544891357, 31.237111533503512]]]),
            {
              "landcover": 0,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55439734458923, 31.14415433188295],
                  [121.55482649803162, 31.142262723015737],
                  [121.55853867530823, 31.142749402689063],
                  [121.55827045440674, 31.144742008507826]]]),
            {
              "landcover": 0,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.55196189880371, 31.14321771473335],
                  [121.55224084854126, 31.141803588958606],
                  [121.55348539352417, 31.142088252335903],
                  [121.55344247817993, 31.1430524283936],
                  [121.552734375, 31.143309540353165]]]),
            {
              "landcover": 0,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54828190803528, 31.142464741296582],
                  [121.54872179031372, 31.14132608718091],
                  [121.55020236968994, 31.141518924726725],
                  [121.54983758926392, 31.142721854849736]]]),
            {
              "landcover": 0,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54664039611816, 31.14321771473335],
                  [121.54733777046204, 31.142253540356368],
                  [121.54951572418213, 31.14324526242864],
                  [121.548410654068, 31.143759484604807]]]),
            {
              "landcover": 0,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54239177703857, 31.140885314174998],
                  [121.54145836830139, 31.140178236531938],
                  [121.54172658920288, 31.139085469804353],
                  [121.54305696487427, 31.13912220166356],
                  [121.54305696487427, 31.140132322216967]]]),
            {
              "landcover": 0,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54350757598877, 31.142143348374752],
                  [121.54385089874268, 31.14098632483649],
                  [121.54473066329956, 31.141243442398363],
                  [121.54447317123413, 31.142345366909918]]]),
            {
              "landcover": 0,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53751015663147, 31.138589588312303],
                  [121.53779983520508, 31.137744747205833],
                  [121.53836846351624, 31.13789167663454],
                  [121.53804659843445, 31.138571222281303]]]),
            {
              "landcover": 0,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.53941988945007, 31.138185534809047],
                  [121.53979539871216, 31.13732232383033],
                  [121.5403425693512, 31.137561085099836],
                  [121.53982758522034, 31.138387561775858]]]),
            {
              "landcover": 0,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54088973999023, 31.13254876588782],
                  [121.54086023569107, 31.13235361419797],
                  [121.54108822345734, 31.132332951054355],
                  [121.54106944799423, 31.132553357687456]]]),
            {
              "landcover": 0,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54213160276413, 31.132716366430433],
                  [121.54221475124359, 31.132456929848505],
                  [121.54254734516144, 31.132530398687084],
                  [121.54240250587463, 31.132803610431303]]]),
            {
              "landcover": 0,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54174000024796, 31.132110247998682],
                  [121.54174000024796, 31.131853105675784],
                  [121.54198676347733, 31.131853105675784],
                  [121.54200285673141, 31.13201841153481]]]),
            {
              "landcover": 0,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54256075620651, 31.132140094830312],
                  [121.54261708259583, 31.13191279949145],
                  [121.5428826212883, 31.131963309613816],
                  [121.54285579919815, 31.132156166197287]]]),
            {
              "landcover": 0,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.5437462925911, 31.13232606333882],
                  [121.54375970363617, 31.132073513423816],
                  [121.54419958591461, 31.13208040115769],
                  [121.54411643743515, 31.13233754286445]]]),
            {
              "landcover": 0,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54344320297241, 31.13278983506805],
                  [121.54343783855438, 31.13256483718556],
                  [121.54377311468124, 31.132576316682286],
                  [121.54373288154602, 31.132810498112157]]]),
            {
              "landcover": 0,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54321253299713, 31.13371277998093],
                  [121.54327690601349, 31.133418907948318],
                  [121.54380261898041, 31.133455642002186],
                  [121.5437462925911, 31.133839052840273],
                  [121.54320448637009, 31.133884970202008]]]),
            {
              "landcover": 0,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[121.54531002044678, 31.1342132786907],
                  [121.54527246952057, 31.134057160110505],
                  [121.5453690290451, 31.13402272215382],
                  [121.54541999101639, 31.13418802423193]]]),
            {
              "landcover": 0,
              "system:index": "35"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//centering at Bangkok, Thailand
var roi_Shanghai = ee.Geometry.Point(121.474674768, 31.2411740353);
var buffer_Shanghai = roi_Shanghai.buffer(15000);
Map.addLayer(buffer_Shanghai,{}, "Shanghai");

Map.setCenter(121.474674768,31.2411740353, 10);
//Filtering to 2000, 2005, 2010, 2015 summer
var L7Filtered2015 = l7Raw.filterDate('2015-06-01','2015-08-31').filterBounds(buffer_Shanghai);
var L7Filtered2010 = l7Raw.filterDate('2010-06-01','2010-08-31').filterBounds(buffer_Shanghai);
var L7Filtered2005 = l7Raw.filterDate('2005-06-01','2005-08-31').filterBounds(buffer_Shanghai);
var L7Filtered2000 = l7Raw.filterDate('2000-06-01','2000-08-31').filterBounds(buffer_Shanghai);


//Creating Simple Composite for cleaner image

var l7Composite15= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2015,
  asFloat: true
});

Map.addLayer(l7Composite15,{'bands':['B3','B2','B1']},'Shanghai Summer 2015');
var l7Composite10= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2010,
  asFloat: true
});

var l7Composite05= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2005,
  asFloat: true
});

var l7Composite00= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2000,
  asFloat: true
});

//Now calculate NDVI, NDWI, NDBI to see what's happeing, train classificator

//NDVI
var ndvi15 = l7Composite15.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi10 = l7Composite10.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi05 = l7Composite05.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi00 = l7Composite00.normalizedDifference(['B4', 'B3']).rename('NDVI');

//NDBI
var ndbi15 = l7Composite15.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi10 = l7Composite10.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi05 = l7Composite05.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi00 = l7Composite00.normalizedDifference(['B5', 'B4']).rename('NDBI');

//NDWI

var ndwi15 = l7Composite15.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi10 = l7Composite10.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi05 = l7Composite05.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi00 = l7Composite00.normalizedDifference(['B2', 'B4']).rename('NDWI');

var landcover_training = BU_training.merge(NBU_training);
var landcover_validation = BU_validation.merge(NBU_validation);

//SETTING BANDS
var bands = ['B1', 'B2', 'B3', 'B4', 'B5', 'B6_VCID_2', 'B7', 'NDVI','NDBI','NDWI'];

//Adding bands to composites
var input15 = l7Composite15.addBands(ndvi15).addBands(ndbi15).addBands(ndwi15);
var input10 = l7Composite10.addBands(ndvi10).addBands(ndbi10).addBands(ndwi10);
var input05 = l7Composite05.addBands(ndvi05).addBands(ndbi05).addBands(ndwi05);
var input00 = l7Composite00.addBands(ndvi00).addBands(ndbi00).addBands(ndwi00);

//Creating the training dataset

var training = input15.select(bands).sampleRegions({
collection: landcover_training,
properties: ['landcover'],
scale: 30
});

var validation = input15.select(bands).sampleRegions({
collection: landcover_validation,
properties: ['landcover'],
scale: 30
});

//Choosing classifier
var trained = ee.Classifier.randomForest({numberOfTrees: 20})
.train({
features: training,
classProperty: 'landcover',
inputProperties: bands
});


//?????Do I put 'class' or 'landcover' in there???? Well, apparently landcover it is

//Classifying 2015,2010,2005,2000 with 2015 trained classifier

var classified2000 = input00.select(bands).classify(trained);
var classified2005 = input05.select(bands).classify(trained);
var classified2010 = input10.select(bands).classify(trained);
var classified2015 = input15.select(bands).classify(trained);

//Mapping results

Map.addLayer(classified2015.mask(classified2015), {'min':0, 'max':1 , 'palette':'ff133f'},'BU 2015');
Map.addLayer(classified2010.mask(classified2010), {'min':0, 'max':1 , 'palette':'b119ff'},'BU 2010');
Map.addLayer(classified2005.mask(classified2005), {'min':0, 'max':1 , 'palette':'blue'},'BU 2005');
Map.addLayer(classified2000.mask(classified2000), {'min':0, 'max':1 , 'palette':'1dfff4'},'BU 2000');

//Exporting to Assets
Export.image.toAsset({ 
  image: classified2015,
  region: buffer_Shanghai,
  description: 'built-up areas, Shanghai, 2015', assetId: 'BuiltUpAreasShanghai2015',
  scale: 30});
  
//Exporting to Google Drive
Export.image.toDrive(
  {image: classified2015,
    description: 'BU Shanghai,2015',
    fileNamePrefix: 'bu_Shanghai_2015',
    region: buffer_Shanghai,
    scale: 30, 
    maxPixels: 1e9
  });
  
  
  
Map.addLayer(ndbi15,{'min':-0.5197, 'max':0.664},'NDBI 2015');
Map.addLayer(ndbi00,{'min':-0.5197, 'max':0.664},'NDBI 2000');

//Calculate a confusion matrix
var accuracyMatrix = trained.confusionMatrix();
print('Resubstitution error matrix: ', accuracyMatrix);

//Estimate the overall accuracy rate
var overallAccuracy = accuracyMatrix.accuracy();
print('Training overall accuracy: ', overallAccuracy);

//Why is my classifier 100% correct???!!!!


//How big is urban area??? And it's not working...
var urban_Shanghai2015masked = classified2015.mask(classified2015);
var urban_Shanghai2015 = urban_Shanghai2015masked.clip(buffer_Shanghai);

var urbanLandUseArea= urban_Shanghai2015.multiply(ee.Image.pixelArea());

var stats = urbanLandUseArea.reduceRegion(
{
'reducer': ee.Reducer.count(),
'scale': 30,
'geometry': buffer_Shanghai,
'maxPixels': 1e9
});
print(stats);

print('urban area: ' + stats.getInfo() + ' square meters');
