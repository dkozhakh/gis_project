/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var l7Raw = ee.ImageCollection("LANDSAT/LE7_L1T"),
    BU_training = /* color: #d6d150 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[37.59815454483032, 55.74997758060833],
                  [37.5981330871582, 55.74981454764531],
                  [37.598369121551514, 55.74979643282958],
                  [37.59848713874817, 55.750031924777936],
                  [37.598122358322144, 55.75005607771791]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.60178089141846, 55.75009834532687],
                  [37.60153412818909, 55.74976624145133],
                  [37.60174870491028, 55.749717935197545],
                  [37.60194182395935, 55.750007771823014]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.59742498397827, 55.74987493030365],
                  [37.59739279747009, 55.749711896911634],
                  [37.59800434112549, 55.74972397348254],
                  [37.59793996810913, 55.74987493030365]]]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.606834173202515, 55.74933148301394],
                  [37.6067054271698, 55.749150332235054],
                  [37.607338428497314, 55.7489631422132],
                  [37.607585191726685, 55.749174485720836]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.614827156066895, 55.750376102760775],
                  [37.61495590209961, 55.74955490114942],
                  [37.61637210845947, 55.749820585915344],
                  [37.616329193115234, 55.750351950018946]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.55478858947754, 55.73996488528175],
                  [37.555389404296875, 55.738370346837335],
                  [37.563629150390625, 55.74025479436318],
                  [37.563114166259766, 55.741414409152696]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.53955364227295, 55.736316678616994],
                  [37.54019737243652, 55.735809285116005],
                  [37.5408411026001, 55.73595425536076],
                  [37.539939880371094, 55.73643748562124]]]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65869736671448, 55.69303164413583],
                  [37.65837550163269, 55.69282604367479],
                  [37.65863299369812, 55.69266277195015],
                  [37.6592230796814, 55.693025597078886],
                  [37.65885829925537, 55.693049785301085]]]),
            {
              "landcover": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.660778760910034, 55.69199758380199],
                  [37.660542726516724, 55.69179197790281],
                  [37.66085386276245, 55.6916589382154],
                  [37.66115427017212, 55.69186454481422]]]),
            {
              "landcover": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65841841697693, 55.69073369513991],
                  [37.6581072807312, 55.69055831980097],
                  [37.65835404396057, 55.69035270633281],
                  [37.658772468566895, 55.69058250954966]]]),
            {
              "landcover": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.63537287712097, 55.76480714453963],
                  [37.63520121574402, 55.764650209530984],
                  [37.63594150543213, 55.764414805833596],
                  [37.635737657547, 55.76423372509926],
                  [37.63508319854736, 55.76435444568225],
                  [37.63489007949829, 55.76424579717439],
                  [37.63550162315369, 55.76394399417507],
                  [37.63586640357971, 55.7638896693871],
                  [37.636510133743286, 55.76447516589147]]]),
            {
              "landcover": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.63692855834961, 55.764396697798],
                  [37.63638138771057, 55.76378101958408],
                  [37.637507915496826, 55.76341281522242],
                  [37.6382052898407, 55.764040571388996],
                  [37.63711094856262, 55.76455363382705]]]),
            {
              "landcover": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.63543725013733, 55.761964108571895],
                  [37.63473987579346, 55.76232629028055],
                  [37.6322078704834, 55.76099827423569],
                  [37.63292670249939, 55.760672299747895],
                  [37.63317346572876, 55.7607869947858],
                  [37.63259410858154, 55.76100431077458],
                  [37.63465404510498, 55.762096908922366],
                  [37.6352334022522, 55.761843380588125]]]),
            {
              "landcover": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61288523674011, 55.755631421471804],
                  [37.61215567588806, 55.755866878196215],
                  [37.611833810806274, 55.75580650481265],
                  [37.611340284347534, 55.7554382251491],
                  [37.611072063446045, 55.75508201692033],
                  [37.61198401451111, 55.75473788045719],
                  [37.61220932006836, 55.75494919268034],
                  [37.61199474334717, 55.75504579217248],
                  [37.61190891265869, 55.75493108024894],
                  [37.611565589904785, 55.75505786709218],
                  [37.61223077774048, 55.75569783248673],
                  [37.612584829330444, 55.75558312248085],
                  [37.61250972747803, 55.755480486926466],
                  [37.61269211769104, 55.755432187748596]]]),
            {
              "landcover": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61372208595276, 55.755492561711584],
                  [37.61446237564087, 55.75534162662888],
                  [37.616039514541626, 55.75589706485296],
                  [37.61519193649292, 55.75661550038849]]]),
            {
              "landcover": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61735916137695, 55.755776318085836],
                  [37.6167368888855, 55.7554382251491],
                  [37.61795997619629, 55.75476806798773],
                  [37.61863589286804, 55.75506390455061]]]),
            {
              "landcover": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61823892593384, 55.75451449200507],
                  [37.6191508769989, 55.753965071720465],
                  [37.62138247489929, 55.7531680966737],
                  [37.62214422225952, 55.753572623921855],
                  [37.61912941932678, 55.75506390455061]]]),
            {
              "landcover": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.62448310852051, 55.75421261368574],
                  [37.625834941864014, 55.752703187043075],
                  [37.627562284469604, 55.75292054807959],
                  [37.627315521240234, 55.75341564369682],
                  [37.62569546699524, 55.75459901751578]]]),
            {
              "landcover": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.62411832809448, 55.751205778101635],
                  [37.62290596961975, 55.75128427273987],
                  [37.62343168258667, 55.74993776590825],
                  [37.62465476989746, 55.74972038825092],
                  [37.62523412704468, 55.75019740985593],
                  [37.6252019405365, 55.75139295736281]]]),
            {
              "landcover": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.62092113494873, 55.748017554695544],
                  [37.62072801589966, 55.74816247959386],
                  [37.61946201324463, 55.74790282210259],
                  [37.61996626853943, 55.747063452343376],
                  [37.6202666759491, 55.74709968450447],
                  [37.61996626853943, 55.7477639348281]]]),
            {
              "landcover": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61564254760742, 55.744557312885156],
                  [37.61535286903381, 55.744364061712076],
                  [37.615588903427124, 55.74423724010956],
                  [37.61593222618103, 55.7443338661298]]]),
            {
              "landcover": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.61151194572449, 55.74519745055983],
                  [37.61070728302002, 55.74456335196891],
                  [37.61142611503601, 55.74408022231631],
                  [37.61276721954346, 55.74467205531636],
                  [37.61235952377319, 55.74518537258772]]]),
            {
              "landcover": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.6377010345459, 55.740583393133434],
                  [37.63539433479309, 55.740118333520876],
                  [37.635737657547, 55.73969554724569],
                  [37.63671398162842, 55.73962910898601],
                  [37.638291120529175, 55.739906940955805]]]),
            {
              "landcover": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.64036178588867, 55.740885376927054],
                  [37.64097332954407, 55.739737826079306],
                  [37.64261484146118, 55.74009417442852],
                  [37.642024755477905, 55.741084684950756]]]),
            {
              "landcover": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.63958930969238, 55.7415316143942],
                  [37.63990044593811, 55.74090953552961],
                  [37.64042615890503, 55.74098805088458],
                  [37.640050649642944, 55.741634286651475]]]),
            {
              "landcover": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65321493148804, 55.73936335481629],
                  [37.653751373291016, 55.738560041437154],
                  [37.654030323028564, 55.73860836150628],
                  [37.653504610061646, 55.73936335481629]]]),
            {
              "landcover": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65759229660034, 55.737539265996034],
                  [37.65660524368286, 55.737116451780985],
                  [37.65689492225647, 55.73677215682245],
                  [37.65766739845276, 55.73730369864129]]]),
            {
              "landcover": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.66312837600708, 55.73757550700135],
                  [37.66458749771118, 55.736699673286275],
                  [37.665778398513794, 55.73725537695688],
                  [37.66544580459595, 55.737345980066074],
                  [37.664780616760254, 55.737068129864745],
                  [37.66356825828552, 55.73780503258681]]]),
            {
              "landcover": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.67289161682129, 55.737798992457115],
                  [37.67263412475586, 55.73738826144505],
                  [37.67285943031311, 55.73735202026587],
                  [37.67309546470642, 55.73771443054328]]]),
            {
              "landcover": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.67386794090271, 55.73887412081713],
                  [37.67381429672241, 55.73852380134605],
                  [37.6746940612793, 55.738354680475936],
                  [37.67495155334473, 55.73888620074281]]]),
            {
              "landcover": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.67189383506775, 55.74031160572117],
                  [37.67194747924805, 55.739973378742505],
                  [37.67309546470642, 55.739870702115404],
                  [37.67356753349304, 55.740184770947685],
                  [37.67340660095215, 55.740269327509154],
                  [37.67314910888672, 55.740106253976556],
                  [37.67245173454285, 55.74017269142395],
                  [37.672226428985596, 55.74041428118826]]]),
            {
              "landcover": 1,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.67736554145813, 55.74308978782729],
                  [37.676968574523926, 55.74258852176699],
                  [37.679715156555176, 55.74172487959529],
                  [37.68014430999756, 55.742220117304164]]]),
            {
              "landcover": 1,
              "system:index": "31"
            })]),
    NBU_training = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65612244606018, 55.69034061138924],
                  [37.65632629394531, 55.690147091783395],
                  [37.65672326087952, 55.6903587538032],
                  [37.656540870666504, 55.69047970301434]]]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65313982963562, 55.691308195051285],
                  [37.65359044075012, 55.69113282228928],
                  [37.65390157699585, 55.69154403993921],
                  [37.65333294868469, 55.69167103275116]]]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65081167221069, 55.691755694396605],
                  [37.65117645263672, 55.69147751973028],
                  [37.6517128944397, 55.6916589382154],
                  [37.65118718147278, 55.69190082821942]]]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.6116943359375, 55.69988840480335],
                  [37.61152267456055, 55.69938053785179],
                  [37.61263847351074, 55.699259616176356],
                  [37.612810134887695, 55.69984003680658]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.60890483856201, 55.70341910689962],
                  [37.60886192321777, 55.702282545832226],
                  [37.60963439941406, 55.702282545832226],
                  [37.61002063751221, 55.703274015837906]]]),
            {
              "landcover": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.603111267089844, 55.70044463246421],
                  [37.603111267089844, 55.699791668749924],
                  [37.60439872741699, 55.700226979104876],
                  [37.60401248931885, 55.70063810109943]]]),
            {
              "landcover": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.43968963623047, 55.76097771226808],
                  [37.439002990722656, 55.759287443724986],
                  [37.4399471282959, 55.759287443724986],
                  [37.440547943115234, 55.76083283497797]]]),
            {
              "landcover": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.46355056762695, 55.75571349188569],
                  [37.46355056762695, 55.75363658563527],
                  [37.466468811035156, 55.75363658563527],
                  [37.46664047241211, 55.755230500300925]]]),
            {
              "landcover": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.425549030303955, 55.78220848684712],
                  [37.425785064697266, 55.7816051566201],
                  [37.42720127105713, 55.781737890071575],
                  [37.4268364906311, 55.78244981632216]]]),
            {
              "landcover": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.446770668029785, 55.786241509450626],
                  [37.446797490119934, 55.785921778692014],
                  [37.44732320308685, 55.78592781137214],
                  [37.447280287742615, 55.786262623653634],
                  [37.446808218955994, 55.786247542081206]]]),
            {
              "landcover": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.67889976501465, 55.74133834823598],
                  [37.67881393432617, 55.74105448683078],
                  [37.67910361289978, 55.740975971609494],
                  [37.67932891845703, 55.74116319995331]]]),
            {
              "landcover": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.689199447631836, 55.740837059677126],
                  [37.68961787223816, 55.74022100949645],
                  [37.690218687057495, 55.740372003087465],
                  [37.68980026245117, 55.74098201124749]]]),
            {
              "landcover": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.686946392059326, 55.73927879629185],
                  [37.68666744232178, 55.73898284001362],
                  [37.68716096878052, 55.73866876150858],
                  [37.68765449523926, 55.73887412081713],
                  [37.68716096878052, 55.739176117837324]]]),
            {
              "landcover": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.69690275192261, 55.73730369864129],
                  [37.69680619239807, 55.737025848138984],
                  [37.6971173286438, 55.7369594053345],
                  [37.69741773605347, 55.7371224920163]]]),
            {
              "landcover": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.703715562820435, 55.7394479131575],
                  [37.703425884246826, 55.73891036058295],
                  [37.70365118980408, 55.73866876150858],
                  [37.70402669906616, 55.73911571862023]]]),
            {
              "landcover": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.704209089279175, 55.74034180441601],
                  [37.70425200462341, 55.74011229374919],
                  [37.704466581344604, 55.7401243732916],
                  [37.704423666000366, 55.74036596335506]]]),
            {
              "landcover": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.701687812805176, 55.743077709202744],
                  [37.701677083969116, 55.74208120980053],
                  [37.70328640937805, 55.74159804941503],
                  [37.704187631607056, 55.742528127831086],
                  [37.703683376312256, 55.74302939466723],
                  [37.70226716995239, 55.74311998437229]]]),
            {
              "landcover": 0,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.696484327316284, 55.74460562552891],
                  [37.69681692123413, 55.74408022231631],
                  [37.697235345840454, 55.74450296108947],
                  [37.69691348075867, 55.74482303168541]]]),
            {
              "landcover": 0,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65820384025574, 55.74444257011657],
                  [37.65845060348511, 55.74415269214556],
                  [37.6587188243866, 55.74422516184019],
                  [37.658525705337524, 55.744376139938424]]]),
            {
              "landcover": 0,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65290379524231, 55.745994588454046],
                  [37.652796506881714, 55.745716799824514],
                  [37.65307545661926, 55.745596021542646],
                  [37.653236389160156, 55.74586173326929]]]),
            {
              "landcover": 0,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65792489051819, 55.748180595168314],
                  [37.65792489051819, 55.74796924627648],
                  [37.658482789993286, 55.74798132338687],
                  [37.65846133232117, 55.748102094284995]]]),
            {
              "landcover": 0,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65194892883301, 55.74972038825092],
                  [37.651991844177246, 55.74957546913983],
                  [37.65293598175049, 55.749660005353384],
                  [37.65289306640625, 55.749786809330296]]]),
            {
              "landcover": 0,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65669107437134, 55.75035440303245],
                  [37.65671253204346, 55.75023967731176],
                  [37.657506465911865, 55.75040270849812],
                  [37.6580536365509, 55.75040874667712],
                  [37.65815019607544, 55.75052347190063],
                  [37.65758156776428, 55.75052347190063]]]),
            {
              "landcover": 0,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65713095664978, 55.75081146280284],
                  [37.65716314315796, 55.75074051487294],
                  [37.657544016838074, 55.750785800800536],
                  [37.657538652420044, 55.75085674864809]]]),
            {
              "landcover": 0,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.65718191862106, 55.75135639898395],
                  [37.65717655420303, 55.7511405387479],
                  [37.65766739845276, 55.75112242454787],
                  [37.65766203403473, 55.75133073734011]]]),
            {
              "landcover": 0,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.549638748168945, 55.70972286891198],
                  [37.54843711853027, 55.70828425750125],
                  [37.55225658416748, 55.707111568677625],
                  [37.55399465560913, 55.7087920087535]]]),
            {
              "landcover": 0,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[37.543909549713135, 55.705963024890394],
                  [37.54221439361572, 55.70535851460028],
                  [37.54369497299194, 55.70391974249468],
                  [37.5457763671875, 55.70526179208601]]]),
            {
              "landcover": 0,
              "system:index": "26"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//centering at Bangkok, Thailand
var roi_Moscow = ee.Geometry.Point(37.6378811, 55.764303);
var buffer_Moscow = roi_Moscow.buffer(15000);
Map.addLayer(buffer_Moscow,{}, "Moscow");

Map.setCenter(37.6378811, 55.764303, 10);

//Filtering to 2000, 2005, 2010, 2015 summer
var L7Filtered2015 = l7Raw.filterDate('2015-06-01','2015-08-31').filterBounds(buffer_Moscow);
var L7Filtered2010 = l7Raw.filterDate('2010-06-01','2010-08-31').filterBounds(buffer_Moscow);
var L7Filtered2005 = l7Raw.filterDate('2005-06-01','2005-08-31').filterBounds(buffer_Moscow);
var L7Filtered2000 = l7Raw.filterDate('2000-06-01','2000-08-31').filterBounds(buffer_Moscow);

Map.addLayer(L7Filtered2000,{},'Moscow 2000');
Map.addLayer(L7Filtered2015,{},'Moscow 2015');
//Creating Simple Composite for cleaner image

var l7Composite15= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2015,
  asFloat: true
});

var l7Composite10= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2010,
  asFloat: true
});

var l7Composite05= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2005,
  asFloat: true
});

var l7Composite00= ee.Algorithms.Landsat.simpleComposite({
  collection: L7Filtered2000,
  asFloat: true
});

//Now calculate NDVI, NDWI, NDBI to see what's happeing, train classificator

//NDVI
var ndvi15 = l7Composite15.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi10 = l7Composite10.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi05 = l7Composite05.normalizedDifference(['B4', 'B3']).rename('NDVI');
var ndvi00 = l7Composite00.normalizedDifference(['B4', 'B3']).rename('NDVI');

//NDBI
var ndbi15 = l7Composite15.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi10 = l7Composite10.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi05 = l7Composite05.normalizedDifference(['B5', 'B4']).rename('NDBI');
var ndbi00 = l7Composite00.normalizedDifference(['B5', 'B4']).rename('NDBI');

//NDWI

var ndwi15 = l7Composite15.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi10 = l7Composite10.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi05 = l7Composite05.normalizedDifference(['B2', 'B4']).rename('NDWI');
var ndwi00 = l7Composite00.normalizedDifference(['B2', 'B4']).rename('NDWI');

var landcover = BU_training.merge(NBU_training);

//SETTING BANDS
var bands = ['B1', 'B2', 'B3', 'B4', 'B5', 'B6_VCID_2', 'B7', 'NDVI','NDBI','NDWI'];

//Adding bands to composites
var input15 = l7Composite15.addBands(ndvi15).addBands(ndbi15).addBands(ndwi15);
var input10 = l7Composite10.addBands(ndvi10).addBands(ndbi10).addBands(ndwi10);
var input05 = l7Composite05.addBands(ndvi05).addBands(ndbi05).addBands(ndwi05);
var input00 = l7Composite00.addBands(ndvi00).addBands(ndbi00).addBands(ndwi00);

//Creating the training dataset

var training = input15.select(bands).sampleRegions({
collection: landcover,
properties: ['landcover'],
scale: 30
});

//Choosing classifier
var classifier = ee.Classifier.randomForest({numberOfTrees: 20})
.train({
features: training,
classProperty: 'landcover',
inputProperties: bands
});

//Getting trained classifier
var trained = classifier.train(training, 'landcover', bands);

//?????Do I put 'class' or 'landcover' in there???? Well, apparently landcover it is

//Classifying 2015,2010,2005,2000 with 2015 trained classifier

var classified2000 = input00.select(bands).classify(trained);
var classified2005 = input05.select(bands).classify(trained);
var classified2010 = input10.select(bands).classify(trained);
var classified2015 = input15.select(bands).classify(trained);

//Mapping results

Map.addLayer(classified2015.mask(classified2015), {'min':0, 'max':1 , 'palette':'ff133f'},'BU 2015');
Map.addLayer(classified2010.mask(classified2010), {'min':0, 'max':1 , 'palette':'b119ff'},'BU 2010');
Map.addLayer(classified2005.mask(classified2005), {'min':0, 'max':1 , 'palette':'blue'},'BU 2005');
Map.addLayer(classified2000.mask(classified2000), {'min':0, 'max':1 , 'palette':'1dfff4'},'BU 2000');

// //Exporting to Assets
// Export.image.toAsset({ 
//   image: classified2015,
//   region: buffer_Moscow,
//   description: 'built-up areas, Moscow, 2015', assetId: 'BuiltUpAreasMoscow2015',
//   scale: 30});
  
//Exporting to Google Drive
Export.image.toDrive(
  {image: classified2015,
    description: 'BU Moscow,2015',
    fileNamePrefix: 'bu_moscow_2015',
    region: buffer_Moscow,
    scale: 30, 
    maxPixels: 1e9
  });
  
  
  
Map.addLayer(ndbi15,{'min':-0.5197, 'max':0.664},'NDBI 2015');
Map.addLayer(ndbi00,{'min':-0.5197, 'max':0.664},'NDBI 2000');

// //Calculate a confusion matrix
// var accuracyMatrix = trained.confusionMatrix();
// print('Resubstitution error matrix: ', accuracyMatrix);

// //Estimate the overall accuracy rate
// var overallAccuracy = accuracyMatrix.accuracy();
// print('Training overall accuracy: ', overallAccuracy);

//Why is my classifier 100% correct???!!!!


//How big is urban area??? And it's not working...
var urban_Moscow2015masked = classified2015.mask(classified2015);
var urban_Moscow2015 = urban_Moscow2015masked.clip(buffer_Moscow);

var urbanLandUseArea= urban_Moscow2015.multiply(ee.Image.pixelArea());

var stats = urbanLandUseArea.reduceRegion(
{
'reducer': ee.Reducer.sum(),
'scale': 30,
'geometry': buffer_Moscow,
'maxPixels': 1e9
});
print(stats);

print('urban area: ' + stats.getInfo() + ' square meters');


